# TODO: write tests. Should considering refactoring main function first since
# it's very long at present, which makes testing difficult.
